---
name: 리팩토링계획
description: 리팩토링 계획 수립 및 영향 분석
---

# 리팩토링 계획

## 1. 현재 코드 분석

리팩토링 대상 코드를 읽고 다음을 파악하세요:

### 구조 분석
- **단일 책임 원칙**: 함수/클래스가 하나의 책임만 가지는가?
- **의존성**: 강한 결합도 문제가 있는가?
- **중복 코드**: DRY 원칙 위반이 있는가?
- **네이밍**: 의미 있는 이름을 사용하는가?

### 코드 품질 지표
```bash
# 복잡도 분석 (radon 설치된 경우)
radon cc src/ -a || echo "radon 미설치"

# 유지보수성 지표
radon mi src/ || echo "radon 미설치"
```

## 2. 리팩토링 목표 정의

다음 중 해당하는 목표를 명확히 하세요:

- [ ] **가독성 개선**: 코드를 이해하기 쉽게
- [ ] **성능 최적화**: 실행 속도 향상
- [ ] **테스트 가능성 향상**: 단위 테스트 작성 용이하게
- [ ] **확장성 개선**: 새 기능 추가 용이하게
- [ ] **기술 부채 해소**: 임시 해결책 제거
- [ ] **의존성 감소**: 모듈 간 결합도 낮추기

## 3. 영향 범위 분석

```bash
# 함수/클래스 사용처 검색
grep -r "target_function_name" src/ tests/ --include="*.py"
```

### 영향받는 파일 목록
- 직접 사용하는 파일
- 간접 의존성이 있는 파일
- 테스트 파일

### 테스트 커버리지 확인
```bash
python -m pytest tests/ --cov=src --cov-report=term-missing | grep "target_module"
```

## 4. 리팩토링 전략 수립

### 단계별 계획
1. **1단계: 안전망 구축**
   - 현재 동작을 보장하는 테스트 추가
   - 테스트 커버리지 80% 이상 확보

2. **2단계: 작은 단위로 리팩토링**
   - 한 번에 하나의 변경만 수행
   - 각 변경 후 테스트 실행

3. **3단계: 지속적 검증**
   - 매 단계마다 테스트 실행
   - 커버리지 유지 확인

4. **4단계: 최종 통합 테스트**
   - 전체 시스템 테스트
   - 성능 측정 및 비교

### 안전장치
```bash
# Git 브랜치 생성
git checkout -b refactor/description

# 각 단계마다 커밋
git commit -m "refactor: 단계별 설명"

# 테스트 실패 시 롤백
git reset --hard HEAD~1
```

## 5. 리팩토링 계획서 작성

다음 형식으로 정리하세요:

### 📋 리팩토링 대상

**파일**: `src/module/file.py`

**현재 코드 (Before)**:
```python
# 문제가 있는 현재 코드
def process_data(data):
    # 너무 복잡한 로직
    # 여러 책임이 섞여 있음
    pass
```

### 🎯 목표
- **주요 목표**: 가독성 및 테스트 가능성 향상
- **부수 목표**: 성능 최적화

### 🔧 변경 계획

**개선된 코드 (After)**:
```python
# 단일 책임 원칙 적용
def validate_data(data):
    """데이터 검증만 담당"""
    pass

def transform_data(data):
    """데이터 변환만 담당"""
    pass

def process_data(data):
    """전체 흐름 조율"""
    validated = validate_data(data)
    return transform_data(validated)
```

### 📊 영향 범위
- **변경 파일**: 3개
  - `src/module/file.py` (수정)
  - `src/module/validators.py` (신규)
  - `src/module/transformers.py` (신규)
- **영향받는 테스트**: 5개 (업데이트 필요)
- **예상 소요 시간**: 4시간

### ⚠️ 위험 요소
- **잠재적 문제**: 기존 호출 코드 수정 필요
- **대응 방안**:
  - 먼저 테스트 추가
  - 단계적으로 마이그레이션
  - 일주일간 모니터링

### ✅ 검증 방법
- [ ] 모든 기존 테스트 통과
- [ ] 새 단위 테스트 추가 (커버리지 90% 이상)
- [ ] 성능 벤치마크 (기존 대비 10% 이상 개선)
- [ ] 코드 리뷰 통과
- [ ] 프로덕션 배포 후 일주일 모니터링

### 📅 일정
1. **Day 1**: 테스트 추가 (안전망)
2. **Day 2**: 코드 분리 (validators, transformers)
3. **Day 3**: 기존 코드 마이그레이션
4. **Day 4**: 테스트 및 문서화
5. **Day 5**: 코드 리뷰 및 배포

### 📚 참고 자료
- 관련 이슈: #123
- 설계 문서: `docs/refactoring/module-redesign.md`
- 벤치마크 결과: `benchmarks/before-after.md`
