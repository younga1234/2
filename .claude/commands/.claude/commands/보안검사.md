---
name: 보안검사
description: 보안 취약점 검사 (비밀키, SQL injection, XSS 등)
---

# 보안 검사

## 1. 비밀키 및 민감정보 노출 확인

```bash
# Detect-secrets로 스캔
detect-secrets scan --baseline .secrets.baseline 2>/dev/null || echo "detect-secrets 미설치"

# 직접 검색
grep -r "api_key\|password\|secret\|token\|비밀번호" src/ --include="*.py" | grep -v "# SAFE" || echo "의심스러운 패턴 없음"
```

## 2. 환경변수 파일 확인

```bash
# .env 파일이 git에 포함되어 있는지 확인
git ls-files | grep -E "\.env$|credentials|secret" && echo "⚠️ 경고: 민감한 파일이 git에 포함됨!" || echo "✓ git에 민감한 파일 없음"
```

## 3. 의존성 취약점 검사

```bash
# pip-audit 사용 (설치된 경우)
python -m pip list --format=json | python -c "import sys, json; print('\n'.join([f\"{p['name']}=={p['version']}\" for p in json.load(sys.stdin)]))" > /tmp/requirements_check.txt
pip-audit -r /tmp/requirements_check.txt 2>/dev/null || echo "pip-audit 사용 불가"
```

## 4. 코드 보안 패턴 검사

다음 항목을 `src/` 디렉토리에서 수동으로 확인하세요:

### SQL Injection (SQL 인젝션)
```python
# 나쁜 예:
cursor.execute(f"SELECT * FROM users WHERE id = {user_id}")  # ❌

# 좋은 예:
cursor.execute("SELECT * FROM users WHERE id = ?", (user_id,))  # ✅
```

### XSS (크로스 사이트 스크립팅)
```python
# 나쁜 예:
html = f"<div>{user_input}</div>"  # ❌

# 좋은 예:
from html import escape
html = f"<div>{escape(user_input)}</div>"  # ✅
```

### 하드코딩된 비밀번호
```python
# 나쁜 예:
API_KEY = "sk-1234567890abcdef"  # ❌
PASSWORD = "admin123"  # ❌

# 좋은 예:
import os
API_KEY = os.getenv("API_KEY")  # ✅
PASSWORD = os.getenv("PASSWORD")  # ✅
```

### 안전하지 않은 난수 생성
```python
# 나쁜 예:
import random
token = random.randint(1000, 9999)  # ❌

# 좋은 예:
import secrets
token = secrets.token_urlsafe(32)  # ✅
```

### 경로 순회 (Path Traversal)
```python
# 나쁜 예:
filename = user_input
with open(f"uploads/{filename}", "r") as f:  # ❌
    data = f.read()

# 좋은 예:
from pathlib import Path
filename = Path(user_input).name  # 디렉토리 제거
safe_path = Path("uploads") / filename
if safe_path.resolve().is_relative_to(Path("uploads").resolve()):  # ✅
    with open(safe_path, "r") as f:
        data = f.read()
```

## 5. 파일 권한 확인

```bash
find data/ -type f -exec ls -la {} \; 2>/dev/null | grep -E "rw-rw-rw-|rwxrwxrwx" && echo "⚠️ 경고: 과도한 파일 권한" || echo "✓ 파일 권한 정상"
```

## 6. 보안 검사 결과 보고

다음 형식으로 정리하세요:

### 🔴 Critical (즉시 수정 필요)
- 발견된 심각한 보안 문제
- 예: 하드코딩된 API 키, SQL Injection 취약점

### 🟡 High (빠른 시일 내 수정)
- 중요한 보안 문제
- 예: XSS 취약점, 안전하지 않은 난수 생성

### 🟢 Medium/Low (개선 권장)
- 덜 심각하지만 개선이 필요한 사항
- 예: 약한 암호화 알고리즘, 과도한 파일 권한

### ✅ 통과한 검사
- 문제가 없는 항목들
- 예: .env 파일 미포함, 파라미터화된 쿼리 사용

### 📋 권장 사항
- 보안 강화를 위한 추가 조치
- 예: 2FA 도입, 암호화 강화, 로깅 개선
